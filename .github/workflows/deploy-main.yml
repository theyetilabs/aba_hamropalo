```yaml
name: Deploy Main to Vercel (with Git Metadata)

on:
  push:
    branches: [main]

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code (for Git Metadata)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Gets full commit history

      - name: Trigger Vercel Production Deploy
        run: |
          if [ -z "${{ secrets.VERCEL_DEPLOY_HOOK_URL }}" ]; then
            echo "❌ Secret VERCEL_DEPLOY_HOOK_URL is missing!"
            exit 1
          fi
          
          # Extract Git metadata
          COMMIT_SHA=$(git rev-parse HEAD)
          COMMIT_MSG=$(git log -1 --pretty=%B | sed 's/"/\\"/g' | tr '\n' ' ')
          BRANCH="main"
          
          # Build payload with Git details (bypasses permission blocks)
          PAYLOAD=$(jq -n \
            --arg name "Production Deploy from GitHub Action" \
            --arg ref "refs/heads/$BRANCH" \
            --arg sha "$COMMIT_SHA" \
            --arg message "$COMMIT_MSG" \
            '{name: $name, ref: $ref, git: {ref: $ref, sha: $sha, message: $message}}')
          
          echo "Payload: $PAYLOAD"
          
          RESPONSE=$(curl -s -w "HTTPSTATUS:%{http_code}" -X POST \
            -H "Content-Type: application/json" \
            "${{ secrets.VERCEL_DEPLOY_HOOK_URL }}" \
            -d "$PAYLOAD")
          
          BODY=$(echo $RESPONSE | sed -e 's/HTTPSTATUS\:.*//g')
          HTTPSTATUS=$(echo $RESPONSE | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
          
          echo "Response Body: $BODY"
          echo "HTTP Status: $HTTPSTATUS"
          
          if [ "$HTTPSTATUS" -eq 200 ]; then
            DEPLOY_ID=$(echo $BODY | jq -r '.id // empty')
            if [ "$DEPLOY_ID" != "null" ] && [ -n "$DEPLOY_ID" ]; then
              echo "✅ Deploy triggered! ID: $DEPLOY_ID | Check Vercel: https://vercel.com/[your-team-or-username]/[project-name]/deployments/$DEPLOY_ID"
            else
              echo "⚠️  HTTP 200 but no deploy ID—check payload."
            fi
          else
            echo "❌ Failed with status: $HTTPSTATUS"
            echo "Body: $BODY"
            exit 1
          fi
